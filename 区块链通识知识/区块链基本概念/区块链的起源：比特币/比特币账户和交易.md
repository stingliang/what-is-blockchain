<!-- 
It is written by liangrui_ibilling,
email:liangrui_ibilling@si-tech.com
-->

## 比特币账户和交易

### 比特币的诞生

2008年11月，一位化名为中本聪（SatoshiNakamoto）的人，在密码学论坛发表的一篇名为[《比特币：一种点对点的电子现金系统》（Bitcoin：APeer-to-PeerElectronicCashSystem）](https://wenku.baidu.com/view/f26c8d916bec0975f465e236.html)的论文中首先提出了比特币。2009年1月3日，中本聪发布了比特币系统并挖掘出第一个区块，被称为“创世区块”，最初的50个比特币宣告问世。

***

### 比特币账户

要对比特币交易进行介绍，我们首先要了解比特币地址的概念。要参与比特币系统中的交易过程，需要一个类似于现实世界中银行“账户”的实体。实际上，比特币的交易参与方实体为一组公私钥的组合，其中，私钥是由程序生成的一串随机数，而其公钥则是根据私钥经过一系列的计算生成的，公私钥之间存在一一对应的关系。其中，公钥作为参与交易的“账户名”，在交易中被引用，用于指明一笔交易中资金的来源及去向，而私钥则作为交易过程中的“验证密码”，用于确认某一交易的合法性。

如果以银行账户做个类比的话，一对比特币公私钥即相当于一个银行账户。其中公钥是公开的信息，它可以作为一个比特币账户对外的“账户名”，用于外界对该账户的引用，类似于银行账户的账号；相应地，比特币地址对应的私钥就相当于银行账户的密码，用于在转账时进行身份验证，从而保证用户的资金安全。

由于公私钥对为一个交易实体的唯一标记，所以需要保证各个用户所持有的比特币地址之间互不冲突，否则就可能出现安全问题。由于私钥本质上是随机生成的比特串，若有两个用户的私钥不巧是相同的，则一个用户完全可以用自己的私钥去替代另一个用户的私钥，从而使用另一个用户的资金。然而，在比特币的设计中，私钥的长度被设定为256比特，其可能的取值范围为$[0,2^{256}-1]$，这是一个巨大的范围，可以认为与世界上沙子的数量相当，能够保证在随机算法实现正确的情况下，基本不可能发生碰撞（生成两个完全相同的私钥）。这也是比特币乃至整个密码学的基础。

简单来说，比特币的一对公私钥以及其对应的钱包地址是按照如下的流程产生的：首先，通过某种随机数生成算法产生出一个256比特的比特串作为私钥，然后再使用椭圆曲线加密算法（EllipticCurvesCryptography,ECC）对这个私钥计算生成公钥。此后，公钥再通过一系列的哈希计算和Base58编码得到钱包地址。比特币交易即为从一个比特币地址向另一个比特币地址进行转账的过程，每个交易可能会包含多笔转账。

#### 比特币账户私钥、公钥和地址

##### 密钥类型

存在三种密钥，并且都是使用 Base58Check 编码成 ASCII 码呈现：

- 私钥 (private key)
- 公钥 (public key)
- 地址 (address)

##### 如何生成私钥（private key）

本质上私钥就是一串随机选出的 256 个 bit 的 01 数字（32 字节 * 8 = 256 bits），但是这串数字却控制着比特币账号的所有权，因此这串数字相当重要，要具有足够的随机性，一般采用密码学安全的伪随机数生成器(CSPNG)，并且需要有一个来自具有足够熵值的源的种子(seed)。

比特币客户端软件使用 Secp256k1ECDSA 标准生成椭圆曲线，使用椭圆生成一个私钥，然后再从私钥中生成对应的公钥。

```shell
# 私钥示例，256个字节，64个16进制字符
de97fdbdb823a197603e1f2cb8b1bded3824147e88ebd47367ba82d4b5600d73
```

##### 如何生成公钥（public key）

Bitcoin 的公钥是通过椭圆曲线密码学算法来生成的，其中密码学原理暂不讨论，可以理解为：
$$
Secp256k1(prikey) = pubkey
$$

```shell
# 公钥示例，这里表示一行，520个字节，130个16进制字符
047c91259636a5a16538e0603636f06c532dd6f2bb42f8dd33fa0cdb39546cf449612f3eaf15db9443b7e0668ef22187de9059633eb23112643a38771c630db911
```

##### 如何生成地址（公钥哈希 hash of pubkey）

![publicKeyHash](https://github-1302606429.cos.ap-chengdu.myqcloud.com/blockchain/images/bitcoin/publicKeyHash.png)

总之地址是为了人们交换方便而弄出来的一个方案，因为公钥太长了(130字符串或66字符串)。地址长度为25字节，转为base58编码后，为34或35个字符。base58是类似base64的编码，但去掉了易引起视觉混淆的字符，又在地址末尾添加了4个字节校验位，保障在人们交换个别字符错误时，也能够因地址校验失败而制止了误操作。

##### 比特币地址生成的过程



![addressGenerator](https://github-1302606429.cos.ap-chengdu.myqcloud.com/blockchain/images/bitcoin/addressGenerator.png)

1. 私钥 （private key）产生

   ```shell
   # 伪随机数产生的256bit私钥示例
   8F72F6B29E6E225A36B68DFE333C7CE5E55D83249D3D2CD6332671FA445C4DD3
   ```

2. 公钥 （public key）产生

   ```shell
   # 用私钥生成公钥
   Secp256k1(prikey) = pubkey
   # 公钥示例
   047c91259636a5a16538e0603636f06c532dd6f2bb42f8dd33fa0cdb39546cf449612f3eaf15db9443b7e0668ef22187de9059633eb23112643a38771c630db911
   ```

3. 地址 （address）产生

   ```shell
   # 处理公钥得到地址
   Base58(Hash(pubkey)) = address
   # 地址示例
   121bWssvSgsA9SKjR4DbYncEAoJjmBFwog
   ```

***

### 比特币交易

比特币交易即为从一个比特币地址向另一个比特币地址进行转账的过程，每个交易可能会包含多笔转账。

![比特币交易](https://github-1302606429.cos.ap-chengdu.myqcloud.com/blockchain/images/bitcoin/bitcoinTx.png)

上图是一个未被确认的比特币交易详情，交易包含从比特币地址1BMKHbD2CpPCgPgk7uezGBtaSdARB73TuQ向比特币地址3DLA1FMVQ6hM26JRFP3RpxYVbpvMTYajmL转0.06837204个比特币这一笔转账。

可以仔细看到，交易中输入的比特币为0.06842204，剩余的0.00005000个比特币被作为手续费发送给挖出包含这个交易的区块的矿工，作为挖矿奖励的一部分。

上述提到的由32个字符组成的看似乱码的比特币地址，实际上是将其本身的256比特的比特串进行了编码，形成（相对于比特串）更为易读、易用的地址。

比特币交易有两种类型，一种是Coinbase交易，也就是挖矿奖励的比特币，这种交易没有发送人。另一种就是常见的普通交易，即普通地址之间的转账交易，如上图中的交易。

***

### Tips

#### 比特钱包

比特币钱包是一个形象的概念，就是保存和管理比特币地址以及对应公私钥对的软件。根据终端类型的不同，比特币钱包可以分为桌面钱包、手机钱包、网页钱包和硬件钱包。不同钱包的安全程度不同，对于少量比特币来说，选用网页钱包这种轻量级的钱包存储；而对于较大额度的比特币，建议使用更高级的钱包存储方式，比如硬件钱包，硬件钱包的成本最高，安全性也相对较高。

除了上面的电脑版钱包外，还有网页版的钱包，以 https://blockchain.info 为代表，还有虚拟币交易网站的钱包也属于此类，这类钱包对币的控制权通过登录网站的用户名和密码保证。这种类型钱包使用最简便，当然安全性也是最低的。因为账户的私钥都是由网站保管的，这样理论上网站可以对用户的账户做任何操作。

#### 如何获得比特币？

1. “矿工”挖矿所得
2. 线下通过中间人购买，线下支付法币或者任何等价物之后，转出方将比特币从他的地址转到购买者的地址，也可以通过线上“交易所”购买
3. 收取比特币作为一般等价物的商家提供服务